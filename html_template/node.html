<!DOCTYPE html>
<html lang="ko">

<head>

	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>작업</title>

	<link rel="stylesheet" href="css/style.css?ver=01">
	<script type="text/javascript" src="js/jquery-1.9.1.min.js"></script>

	<!--스크롤바 디자인 적용(크롬,IE,파이어폭스,엣지 공용)-->
	<link rel="stylesheet" href="css/jquery.mCustomScrollbar.min.css?ver=01">
	<script type="text/javascript" src="js/jquery.mCustomScrollbar.concat.min.js"></script>

	<!--트리메뉴-->
	<script type="text/javascript" src="js/jquery.treeview.js"></script>

</head>

<body onload="setLinkDivVisibility(false)">

	<!--가로 패딩30px 적용 / 100%영역-->
	<div style="width:100%; padding:30px;">

		<!--gml 메뉴 스크립트-->
		<script>
			$(".gml a").click(function () {
				$(".gml a").removeClass("active");
				$(this).addClass("active");
			});
		</script>
		<!--//상단아이콘-->

		<!--컨텐츠2-->
		<div class="box_wrap">
			<!--타이틀-->
			<div class="con_title">
				<h3 class="title_b">Topology Properties</h3>
				<!--최소화 주석처리-->
				<!--<a href="#" class="bt_sizedown_b"><span class="blind">최소화</span></a>-->
				<a href="#" class="bt_sizeup_b"><span class="blind">최대화</span></a>
				<a href="#" class="bt_close_b"><span class="blind">닫기</span></a>
			</div>
			<!--//타이틀-->

			<!--내용-->
			<div class="con_area">
				<!--<div class="space10"></div>-->

				<h4 class="inner_title">Node & Link</h4>

				<div class="line_form">
					<span class="c_left">Node hiding</span>
					<span class="c_right mid">
						<input type="checkbox" id="2" name="" class="onoff">
						<label for="2" class="onoff"><span class="hide">선택</span></label>
					</span>
				</div>

				<div class="line_form">
					<span class="c_left">Link hiding</span>
					<span class="c_right mid">
						<input type="checkbox" id="3" name="" class="onoff">
						<label for="3" class="onoff"><span class="hide">선택</span></label>
					</span>
				</div>

				<div class="line_form">
					<span class="c_left">Name</span>
					<span class="c_right">
						<label for="">Name</label>
						<input type="text" name="" id="input_node_name" class="base w100" placeholder="" value="" />
					</span>
				</div>

				<div class="line_form">
					<span class="c_left">Node Type</span>
					<span class="c_right">
						<label for="">Node Type</label>
						<input type="text" name="" id="input_node_type" class="base w100" placeholder="" value="" />
					</span>
				</div>

				<div class="line_form">
					<span class="c_left">X-Coordinate</span>
					<span class="c_right">
						<label for="">X-Coordinate</label>
						<input type="text" name="" id="input_node_xcoordinate" class="base w100" placeholder="" value="" />
					</span>
				</div>

				<div class="line_form">
					<span class="c_left">Y-Coordinate</span>
					<span class="c_right">
						<label for="">Y-Coordinate</label>
						<input type="text" name="" id="input_node_ycoordinate" class="base w100" placeholder="" value="" />
					</span>
				</div>

				<div class="line_form">
					<span class="c_left">Latitude</span>
					<span class="c_right">
						<label for="">Latitude</label>
						<input type="text" name="" id="input_node_latitude" class="base w100" placeholder="" value="" />
					</span>
				</div>

				<div class="line_form">
					<span class="c_left">Longitude</span>
					<span class="c_right">
						<label for="">Longitude</label>
						<input type="text" name="" id="input_node_longitude" class="base w100" placeholder="" value="" />
					</span>
				</div>

				<div class="line_form">
					<span class="c_left">Rotation</span>
					<span class="c_right">
						<label for="">Rotation</label>
						<input type="text" name="" id="input_node_rotation" class="base w100" placeholder="" value="" />
					</span>
				</div>

				<div class="line_form">
					<span class="c_all">Node & Link data</span>

					<!--항목-->
					<ul class="account6_head">
						<li>Selec<br />tion</li>
						<li>Node<br />Name</li>
						<li>Node<br />Type</li>
						<li class="one">Link</li>
						<li>Node<br />Hiding</li>
						<li>Link<br />Hiding</li>
					</ul>
					<!--//항목-->

					<!--리스트-->
					<div class="mCustomScrollbar tbl_area">
						<table class="type01">
							<caption>이표는 상세목록입니다</caption>
							<colgroup>
								<col style="width:12%" />
								<col style="width:22%" />
								<col style="width:22%" />
								<col style="width:12%" />
								<col style="width:16%" />
								<col style="width:16%" />
							</colgroup>

							<tbody id="grid_table_body">								
							</tbody>

						</table>
					</div>
					<!--컨텐츠3-->
					<div id="link_div" class="con_area">

						<!--내용-->
						<div class="con_area">

							<div class="line_form">

								<!--항목-->
								<ul class="account3_head">
									<li>Selection</li>
									<li>Node Name</li>
									<li>Link</li>
								</ul>
								<!--//항목-->

								<!--리스트-->
								<div class="mCustomScrollbar tbl_area">
									<table class="type01" id="">
										<caption>이표는 상세목록입니다</caption>
										<colgroup>
											<col style="width:21%" />
											<col style="width:42%" />
											<col style="width:37%" />
										</colgroup>

										<tbody id="link_grid_table_body">											
										</tbody>

									</table>
								</div>
								<!--//리스트-->
							</div>

							<!--추가/삭제 버튼-->
							<ul class="btn_change">
								<li><button class="add"><span class="blind">추가</span></button></li>
								<li><button class="del"><span class="blind">삭제</span></button></li>
							</ul>
							<!--//추가/삭제 버튼-->

							<!--하단 버튼-->
							<ul class="btn_group">
								<li><a href="#" class="ok" onclick="hideLinkDiv('link_div')"><img
											src="images/ic_ok.png" class="lk" >OK</a></li>
								<li><a href="#" class="cancle" onclick="hideLinkDiv('link_div')"><img
											src="images/ic_cancle.png" class="lk">Cancle</a>
								</li>
							</ul>
							<!--//하단 버튼-->

						</div>
						<!--//내용-->

					</div>
					<!--//리스트-->
				</div>

				<!--하단 버튼-->
				<ul class="btn_group">
					<li><a href="#" class="ok" style="" onclick="updateSketchupNode()"><img src="images/ic_ok.png" class="lk">OK</a></li>
					<li><a href="#" class="cancle"><img src="images/ic_cancle.png" class="lk">Cancle</a></li>
				</ul>
				<!--//하단 버튼-->

			</div>
			<!--//내용-->

		</div>
		<!--//컨텐츠2-->


		<!--//컨텐츠3-->
</body>
<script>
	function setLinkDivVisibility(visibility) {
		if (visibility) {
			document.getElementById("link_div").style.display = "block";
		} else {
			document.getElementById("link_div").style.display = "none";
		}
	}

	function showLinkDiv(id,index) {
	
		if($("#" + id).css("display") == "none"){
			$("#" + id).show(500);
		}	
		
		var d = gridData[index];

		data = "";

		for(var i=0;i<linkGridData.length;i++) {
			var l = linkGridData[i];
			
			if(d.id === l.node1Id) {
				data += "<tr><td class='al_center'><label for=''>check</label><input type='checkbox'" +
														"id='' name=''></td>" +
												"<td class='al_center'>" +  d.name + "</td>" +
												"<td class='al_center'>" +  l.node1Name + "-" + l.node2Name + "</td></tr>";
			} 
			
			if(d.id == l.node2Id) {
				data += "<tr><td class='al_center'><label for=''>check</label><input type='checkbox'" +
														"id='' name=''></td>" +
												"<td class='al_center'>" +  d.name + "</td>" +
												"<td class='al_center'>" +  l.node2Name + "-" + l.node1Name + "</td></tr>";
			}
		}

		document.getElementById("link_grid_table_body").innerHTML = data;

		return false;
	}

	function hideLinkDiv(id) {
		$("#" + id).hide(500);
	}

	function UpdateGrid() {
		var data = "";

		for (var i = 0; i < gridData.length; i++) {

			data += "<tr>" +
				"<td class='al_center'><label for=''>check</label><input type='checkbox' onclick='nodeGridCheckboxClicked(this);' id='" +
				"node_grid_check_" + i + "' name='' " + (gridData[i]["selection"] ? "checked" : "") + "></td>" +
				"<td class='al_center'>" + gridData[i]["name"] + "</td>" +
				"<td class='al_center'>" + gridData[i]["type"] + "</td>" +
				"<td class='al_center'><a href='#grid_table_body'><img src='images/ic_link.png' style='vertical-align:center' onclick=\"showLinkDiv('link_div'," + i + ")\"></a></td>" +
				"<td class='al_center'><img id=" + "node_" + i + " src='" + gridData[i]["visibleImage"] +
				"' style='vertical-align:center' onclick='node_visibility_click(" + i + ")'></td>" +
				"<td class='al_center'><img id=" + "node_" + i + " src='" + gridData[i]["visibleImage"] +
				"' style='vertical-align:center' onclick='node_visibility_click(" + i + ")'></td>" +
				
				"</tr>";
		}

		document.getElementById("grid_table_body").innerHTML = data;
	}

	function node_visibility_click(index) {
		var visibility_image = document.getElementById("node_" + index);

		var d = gridData[index];

		if (visibility_image.src.indexOf("images/show_s.png") != -1) {
			visibility_image.src = "images/hide_s.png";
			d["visibleImage"] = "images/hide_s.png";
			d["nodeVisible"] = false;
		}
		else {
			visibility_image.src = "images/show_s.png";
			d["visibleImage"] = "images/show_s.png";
			d["nodeVisible"] = true;
		}

		//node의  visibility도 update 한다.		
		sketchup.updateNode(d);
	}

	//node grid의 체크 박스를 클릭 했을때의 처리.
	function nodeGridCheckboxClicked(obj) {
		if(obj.checked) {
			//uncheck another items
			for(var i=0;i<gridData.length;i++) {
				var targetObj = document.getElementById("node_grid_check_" + i);

				if(targetObj === obj) {
					updateNodeDialogProperty(gridData[i]);
					sketchup.selectCell(gridData[i].id);
				} else {
					targetObj.checked = false;
				}
			}
		} 	
		else {
			updateNodeDialogProperty(undefined);
		}	
	}

	var gridData = [];
	var currentNodeGridData = null;

	function updateNodeGrid(nodeGridData) {
		
		if (undefined != nodeGridData && undefined != gridData) {
			gridData = [];
			for (var i = 0; i < nodeGridData.length; i++) {
				var gridItem = nodeGridData[i];

				var d = (gridData[i] = {});

				d["id"] = gridItem.id;

				if(currentNodeGridData != null && currentNodeGridData["id"] === d["id"]) {
					d["selection"] = true;
				} else {
					d["selection"] = false;
				}
				
				d["name"] = gridItem.name;
				d["nodeType"] = gridItem.type;
				d["editLink"] = 1;
				d["nodeVisible"] = gridItem.nodeVisible;
				d["visibleImage"] = gridItem.nodeVisible ? "images/show_s.png" : "images/hide_s.png";
				d["x"] = gridItem.x;
				d["y"] = gridItem.y;
				d["z"] = gridItem.z;
				d["linkVisible"] = true;
				d["lat"] = gridItem.lat;
				d["lon"] = gridItem.lon;
				d["rotation"] = gridItem.rotation;
			}

			UpdateGrid();
		}
	}

	function updateSketchupNode() {
		var nodeName = document.getElementById("input_node_name");
		currentNodeGridData.name = nodeName.value;

		var nodeType = document.getElementById("input_node_type");		
		currentNodeGridData.type = nodeType.value;
		
		var x = document.getElementById("input_node_xcoordinate");
		var y = document.getElementById("input_node_ycoordinate");

		currentNodeGridData.x = x.value;
		currentNodeGridData.y = y.value;
		
		sketchup.updateNode(currentNodeGridData);
	}

	function updateNodeDialogProperty(node) {
		// if ('' == node) {
		// 	return;
		// }			

		currentNodeGridData = node;

		var nodeName = document.getElementById("input_node_name");

		if (undefined != nodeName) {
			nodeName.value = node.name === undefined ? '' : node.name;
		}

		var nodeType = document.getElementById("input_node_type");

		if(undefined != nodeType) {
			nodeType.value = node.type === undefined ? '' : node.type;
		}

		var x = document.getElementById("input_node_xcoordinate");

		if (x != undefined) {
			x.value = node.x === undefined ? '' : node.x;
		}

		var y = document.getElementById("input_node_ycoordinate");

		if (y != undefined) {
			y.value = node.y === undefined ? '' : node.y;
		}

		var lat = document.getElementById("input_node_latitude");
		lat.value = node.lat === undefined ? '' : node.lat;

		var lon = document.getElementById("input_node_longitude");
		lon.value = node.lon === undefined ? '' : node.lon;

		var rotation = document.getElementById("input_node_rotation");
		rotation.value = node.rotation === undefined ? '' : node.rotation;
	}	

	var linkGridData = [];

	function updateLink(linkInfo) {
		if (undefined != linkInfo && undefined != linkGridData) {
			linkGridData = [];
			for (var i = 0; i < linkInfo.length; i++) {
				var gridItem = linkInfo[i];

				var d = (linkGridData[i] = {});

				d["node1Id"] = gridItem.node1_id;
				d["node1Name"] = gridItem.node1_name;
				d["node2Id"] = gridItem.node2_id;
				d["node2Name"] = gridItem.node2_name;				
			}			
		}
	}
</script>

</html>