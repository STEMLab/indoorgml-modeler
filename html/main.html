<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <link href="../vendor/Semantic-UI/semantic.min.css" rel="stylesheet" />
    <script src="../vendor/jquery.js"></script>
    <script src="../vendor/Semantic-UI/semantic.min.js"></script>
    <script src="../vendor/vue.js"></script>
    <link rel="stylesheet" href="../vendor/SlickGrid-master/slick.grid.css" type="text/css" />
    <link rel="stylesheet" href="../vendor/SlickGrid-master/css/smoothness/jquery-ui-1.8.16.custom.css"
        type="text/css" />
    <link rel="stylesheet" href="../vendor/SlickGrid-master/examples/examples.css" type="text/css" />
    <style>
        /* Give the content some space */
        body {
            padding: 15px;
        }

        /* Fix footer position to bottom */
        .footer {
            position: absolute;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            border-top: 1px solid silver;
        }

        /* Define a 128x128 preview square */
        .preview {
            position: relative;
            display: inline-block;
            width: 128px;
            height: 128px;
            font-size: 0px;
            background: url("../images/transparent.png");
            overflow: hidden;
        }

        .preview span {
            display: inline-block;
            width: 50%;
            height: 100%;
        }

        .preview img {
            display: inline-block;
            max-width: 100%;
            max-height: 100%;
            /* Center element */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translateX(-50%) translateY(-50%);
        }

        /* Fine tune input field sizes */
        .ui.form .field .ui.label {
            width: 60px;
        }

        .ui.form .field .ui.input {
            width: 128px;
        }

        .ui.form .field .ui.input input {
            width: 60px;
        }

        .cell-title {
            font-weight: bold;
        }

        .cell-effort-driven {
            text-align: center;
        }
    </style>
</head>

<body>
    <div id="app">
        <!--
      cell을 선택했을때의 block
    -->
        <template v-if="cell">
            <h2>Cell Space Properties</h2>
            <div class="ui padded grid">
                <div class="sixteen wide centered column">
                    <div class="ui three column grid">
                        <div class="row">
                            <div class="column">
                                <h3>Cell Create</h3>
                            </div>
                            <div class="column">
                                <button class="ui button">Create</button>
                            </div>
                        </div>
                        <div class="row">
                            <div class="column">
                                <h3>Cell Type</h3>
                            </div>
                            <div class="column">
                                <select id="selectCellType" class="ui dropdown">
                                    <option value="">Cell type</option>
                                    <option value="SPACE">Cell space</option>
                                    <option value="ELEVATOR">Elevator</option>
                                    <option value="STAIR">Stair</option>
                                    <option value="DOOR">Door</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="column">
                                <h3>Cell Group</h3>
                            </div>
                            <div class="column">
                                <button class="ui labled icon button">
                                    <i class="object group outline icon"></i>
                                    Group
                                </button>
                            </div>
                        </div>
                        <div class="row">
                            <div class="column">
                                <h3>Cell Name</h3>
                            </div>
                            <div class="column">
                                <div class="ui input">
                                    <input type="text" placeholder="cell name..." id="input_cell_name">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="column">
                                <h3>Group Name</h3>
                            </div>
                            <div class="column">
                                <div class="ui input">
                                    <input type="text" placeholder="group name..." id="input_group_name">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="eight wide column">
                                <button class="ui button" v-on:click="showThisCellOnly">Show this cell only</button>
                            </div>
                        </div>
                        <div class="row">
                            <div style="width: 400px;">
                                <div id="myGrid" style="width: 100%; height: 500px;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </template>
        <!--
      door를 선택했을때의 block
    -->
        <template v-else-if="door">
            <h2>Door properties</h2>
            <div class="ui padded grid">
                <div class="eight wide column">
                    <template v-if="door.type">
                        <h3>Name: {{ door.name }}</h3>
                        <div class="ui one column vertically padded grid">
                            <div class="column">
                                <div class="ui label">
                                    Door Type: {{ door.type }}
                                </div>
                            </div>
                            <div class="column">
                                <select id="selectDoorType" class="ui dropdown" onchange="onDoorTypeChanged()">
                                    <option value="">Door type</option>
                                    <option value="PASSABLE">Passable</option>
                                    <option value="ONESIDE">One side</option>
                                    <option value="NOTPASSABLE">Not passable</option>
                                </select>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </template>
        <!--
      poi를 선택했을 때의 block
    -->
        <template v-else-if="poi">
            <h2>Poi properties</h2>
            <div class="ui padded grid">
                <div class="sixteen wide centered column">
                    <div class="ui two column grid">
                        <div class="row">
                            <div class="column">
                                <h3>Hide Poi</h3>
                            </div>
                            <div class="column">
                                <div class="ui toggle checkbox" id="checkBoxPoiVisibility">
                                    <input type="checkbox" name="public">
                                    <label></label>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="column">
                                <h3>Name</h3>
                            </div>
                            <div class="column">
                                <div class="ui input">
                                    <input type="text" id="textBoxPoiName">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="column">
                                <h3>Poi Type</h3>
                            </div>
                            <div class="column">
                                <select class="ui dropdown" id="dropboxPoiType" onchange="onPoiTypeChanged();">
                                    <option value="">POI type</option>
                                    <option value="NONE">Door</option>
                                    <option value="SPACE">Window</option>
                                    <option value="ETC">Room</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="column">
                                <h3>X-Coordinate</h3>
                            </div>
                            <div class="column">
                                <div class="ui input">
                                    <input type="text" id="poi_xcoordinate">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="column">
                                <h3>Y-Coordinate</h3>
                            </div>
                            <div class="column">
                                <div class="ui input">
                                    <input type="text" id="poi_ycoordinate">
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div style="width: 400px;">
                                <div id="myGrid" style="width: 100%; height: 500px;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </template>
        <!--      
            node를 선택했을때의 block    
        -->
        <template v-else-if="node">
            <h2>Topology properties</h2>
            <div class="ui padded grid">
                <div class="sixteen wide centered column">
                    <div class="ui two column grid">
                        <div class="row">
                            <div class="column">
                                <h3>Hide Node</h3>
                            </div>
                            <div class="column">
                                <div class="ui toggle checkbox" id="checkBoxNodeVisibility" >
                                    <input type="checkbox" name="public" onClick="onClickCheckBoxNodeVisibility(this)">
                                    <label></label>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="column">
                                <h3>Hide Link</h3>
                            </div>
                            <div class="column">
                                <div class="ui toggle checkbox" id="checkBoxLinkVisibility">
                                    <input type="checkbox" name="public" onClick="onClickCheckBoxLinkVisibility(this)">
                                    <label></label>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="column">
                                <h3>Name</h3>
                            </div>
                            <div class="column">
                                <div class="ui input">
                                    <input type="text" id="inputNodeName">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="column">
                                <h3>Node Type</h3>
                            </div>
                            <div class="column">
                                <select class="ui dropdown" id="dropdownNodeType"
                                    onchange="onDropdownNodeTypeChanged();">
                                    <option value="">Node type</option>
                                    <option value="0">Door</option>
                                    <option value="1">Window</option>
                                    <option value="3">Room</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="column">
                                <h3>X-Coordinate</h3>
                            </div>
                            <div class="column">
                                <div class="ui input">
                                    <input type="text" id="node_xcoordinate">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="column">
                                <h3>Y-Coordinate</h3>
                            </div>
                            <div class="column">
                                <div class="ui input">
                                    <input type="text" id="node_ycoordinate">
                                </div>
                            </div>
                        </div>
                        <div class="row" style="display:none;" id="linkGridHeader">
                            <div class="column">
                                <h3>Links</h3>
                            </div>
                            <div class="eight wide column">
                                <div class="ui buttons">
                                    <button class="ui button" onclick="addLink();">Add</button>
                                    <button class="ui button" onclick="deleteLink();">Delete</button>
                                    <button class="ui button" onclick="hideLinkGrid();">Close</button>
                                </div>
                            </div>
                        </div>
                        <div class="row" style="display:none;" id="linkGridDiv">
                            <div class="twelve wide column">
                                <div style="width: 280px;"></div>
                                <div id="linkGrid" style="width: 100%; height: 200px;"></div>
                            </div>
                        </div>
                        <div class="row">
                            <h3>Nodes</h3>
                            <div style="width: 400px;">
                                <div id="myGrid" style="width: 100%; height: 300px;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </template>
        <!--
      층을 선택했을 때의 block
    -->
        <template v-else-if="floors">
            <h2>Floor properties</h2>
            <div class="ui padded grid">
                <div class="sixteen wide centered column">
                    <div class="ui two column grid">
                        <div class="row">
                            <div class="column">
                                <h3>Hide floor</h3>
                            </div>
                            <div class="column">
                                <div class="ui toggle checkbox" id="checkBoxFloorVisibility">
                                    <input type="checkbox" name="public">
                                    <label></label>
                                </div>
                            </div>
                        </div>
                        <br />
                        <div class="row">
                            <div class="column">
                                <h3>Floor</h3>
                            </div>
                            <div class="column">
                                <select class="ui dropdown" id="dropdownFloor" onchange="onDropdownFloorChanged();">
                                    <option value="">Gender</option>
                                    <option value="1">Male</option>
                                    <option value="0">Female</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="column">
                                <h3>Floor name</h3>
                            </div>
                            <div class="column">
                                <div class="ui input">
                                    <input type="text" placeholder="1F" id="textInputFloorName">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="column">
                                <h3>Floor elevation</h3>
                            </div>
                            <div class="column">
                                <div class="ui input">
                                    <input type="text" placeholder="0cm" id="textInputFloorElevation">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="column">
                                <h3>Floor height</h3>
                            </div>
                            <div class="column">
                                <div class="ui input">
                                    <input type="text" placeholder="350cm" id="textInputFloorHeight">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="column">
                                <h3>Fix floor height</h3>
                            </div>
                            <div class="column">
                                <div class="ui toggle checkbox" id="checkboxFixFloorHeight">
                                    <input type="checkbox" name="public">
                                    <label></label>
                                </div>
                            </div>
                        </div>


                        <div class="row">
                            <div style="width: 400px;">
                                <div id="myGrid" style="width: 100%; height: 500px;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </template>
        <template v-else>
            <h2 id="DefaultTitle">{{title}}</h2>
            <h3>[No Entity Selected]</h3>
            <p>Select an entity.</p>

            <div class="ui padded grid footer">
                <div class="four wide column">
                    <button class="ui button" v-on:click="save">Export</button>

                </div>
                <div class="four wide column">
                    <button class="ui button" v-on:click="read">Import</button>
                </div>
                <div class="eight wide column right aligned">
                    <button class="ui button" v-on:click="cancel">Close</button>
                    <button class="ui button" v-on:click="create">Create</button>

                </div>
            </div>
        </template>
    </div>

    <script src="../vendor/SlickGrid-master/lib/firebugx.js"></script>

    <!--
  <script src="../vendor/SlickGrid-master/lib/jquery-1.7.min.js"></script>
  -->
    <script src="../vendor/SlickGrid-master/lib/jquery-ui-1.8.16.custom.min.js"></script>
    <script src="../vendor/SlickGrid-master/lib/jquery.event.drag-2.2.js"></script>

    <script src="../vendor/SlickGrid-master/slick.core.js"></script>
    <script src="../vendor/SlickGrid-master/slick.formatters.js"></script>
    <script src="../vendor/SlickGrid-master/slick.editors.js"></script>
    <script src="../vendor/SlickGrid-master/slick.grid.js"></script>
    <script>
        function onClickCheckBoxLinkVisibility(checkbox) {
            sketchup.setLinkVisibility(checkbox.checked.toString());
        }

        function onClickCheckBoxNodeVisibility(checkbox) {            
            sketchup.setNodeVisibility(checkbox.checked.toString());
        }

        function onCellTypeChanged() {
            var x = document.getElementById("selectCellType").value;
            app.cell.type = x;
        }

        function onDoorTypeChanged() {
            var x = document.getElementById("selectDoorType").value;
            app.door.type = x;
        }

        function onPoiTypeChanged() {
            var x = document.getElementById("selectPoiType").value;
            app.poi.type = x;
        }

        function updateSketchUpCells() {
            if (undefined != grid) {

            }
        }

        var app = new Vue({
            el: "#app",
            data: {
                cell: null,
                door: null,
                node: null,
                poi: null,
                floor: null,
                floors: null,
                editMode: "",
                title: "",
            },
            methods: {
                save: function () {
                    sketchup.save();
                },
                read: function () {
                    sketchup.read();
                },
                create: function () {
                    //alert(editMode);

                    if (editMode == "CELL") {
                        sketchup.createCell();
                    } else if (editMode == "POI") {
                        sketchup.createPoi();
                    } else if (editMode == "NODE") {
                        sketchup.createNode();
                    } else if (editMode == "DOOR") {
                        sketchup.createDoor();
                    } else if (editMode == "FLOOR") {
                        if (null != this.floor) {
                            sketchup.createFloorLayer(this.floor);
                        }
                        else {
                            var elevation = document.getElementById("textInputFloorElevation").value;
                            var height = document.getElementById("textInputFloorHeight").value;
                            var name = document.getElementById("textInputFloorName").value;
                            var new_floor_data = {
                                name: name,
                                elevation: parseFloat(elevation),
                                height: parseFloat(height)
                            }
                        }
                    }
                },
                cancel: function () {
                    sketchup.cancel();
                },
                showThisCellOnly: function () {
                    sketchup.showThisCellOnly();
                },
                createFloorLayer: function () {
                    sketchup.createFloorLayer(this.floor);
                },
            },
            mounted: function () {
                sketchup.ready();
            },
        });



        function updateTitle(title) {
            var x = document.getElementById("DefaultTitle");
            app.title = title;

            if (x != null) {
                x.innerHTML = app.title;
            }
        }

        function updateDoor(door) {
            app.cell = null;
            app.door = door;
            app.node = null;
            app.poi = null;
            app.floor = null;
            app.floors = null;
            editMode = "DOOR";
            updateTitle("Door Properties");
        }

        function updateLinkGrid() {
            createLinkGrid();

            data = [];

            for(var i=0;i<linkHash.length;i++) {
                var gridItem = linkHash[i];

                var d = (data[i] = {});

                d["selection"] = 0;
                d["linkedNode1"] = gridItem.node1_name;
                d["linkedNode2"] = gridItem.node2_name;
                d["selectLinkLine"] = 1;                    
            }

            linkGrid.setData(data);
            linkGrid.render();
        }

        function updateCellGrid(gridData) {
            createCellGrid();
            if (undefined != grid && null != gridData) {
                data = [];
                for (var i = 0; i < gridData.length; i++) {
                    var gridItem = gridData[i];

                    var d = (data[i] = {});

                    d["selection"] = true;
                    d["name"] = gridItem.name;
                    d["group"] = gridItem.layer;
                    d["visible"] = true;
                }
                grid.setData(data);
                grid.render();
            }
        }

        function updatePoiGrid(gridData) {
            createPoiGrid();
            if (undefined != grid && null != gridData) {
                data = [];
                for (var i = 0; i < gridData.length; i++) {
                    var gridItem = gridData[i];

                    var d = (data[i] = {});

                    d["selection"] = true;
                    d["name"] = gridItem.name;
                    d["group"] = gridItem.layer;
                    d["visible"] = true;
                }
                grid.setData(data);
                grid.render();
            }
        }

        function updateNodeGrid(gridData) {
            createNodeGrid();
            if (undefined != grid && null != gridData) {
                data = [];
                for (var i = 0; i < gridData.length; i++) {
                    var gridItem = gridData[i];

                    var d = (data[i] = {});

                    d["selection"] = true;
                    d["name"] = gridItem.name;
                    d["nodeType"] = gridItem.type;
                    d["editLink"] = 1;
                    d["nodeVisibile"] = true;
                    d["linkVisible"] = true;
                }
                grid.setData(data);
                grid.render();
            }
        }

        function updateFloorGrid(gridData) {
            createFloorGrid();

            if (undefined != grid && null != gridData) {
                data = [];
                for (var i = 0; i < gridData.length; i++) {
                    var gridItem = gridData[i];

                    var d = (data[i] = {});

                    d["selection"] = true;
                    d["name"] = gridItem.name;
                    d["floorElevation"] = gridItem.elevation;
                    d["floorHeight"] = gridItem.height;
                    d["floorVisibile"] = true;
                }
                grid.setData(data);
                grid.render();
            }
        }


        function createNodeGrid() {

            var newColumns = [
                { id: "selection", name: "선택", width: 40, minWidth: 20, maxWidth: 80, cssClass: "cell-effort-driven", field: "selection", formatter: Slick.Formatters.Checkmark, editor: Slick.Editors.Checkbox },
                { id: "name", name: "이름", field: "name", width: 80, cssClass: "cell-title", editor: Slick.Editors.Text, validator: requiredFieldValidator },
                { id: "nodeType", name: "종류", field: "nodeType", width: 80, editor: Slick.Editors.LongText },
                { id: "editLink", name: "링크", width: 40, minWidth: 20, maxWidth: 80, cssClass: "cell-effort-driven", field: "editLink", formatter: imageFormatter },
                { id: "nodeVisibile", name: "노드가시화", width: 70, minWidth: 20, maxWidth: 80, cssClass: "cell-effort-driven", field: "nodeVisibile", formatter: Slick.Formatters.Visible, editor: Slick.Editors.Checkbox },
                { id: "linkVisible", name: "링크가시화", width: 70, minWidth: 20, maxWidth: 80, cssClass: "cell-effort-driven", field: "linkVisible", formatter: Slick.Formatters.Visible, editor: Slick.Editors.Checkbox },
            ];

            grid = new Slick.Grid("#myGrid", data, newColumns, options);

            grid.onClick.subscribe(function (e, args) {
                if (args.cell == 3) {         
                    selectedNode = grid.getDataItem(args.row)["name"];

                    //show link div
                    document.getElementById("linkGridDiv").style.display = "block";
                    document.getElementById("linkGridHeader").style.display = "block";
                    updateLinkGrid();
                    //sketchup.requestLinkInfo(selectedNode);                    
                }
            });
        }        

        function createLinkGrid() {
            var linkGridColumns = [
                { id: "selection", name: "선택", width: 40, minWidth: 20, maxWidth: 80, cssClass: "cell-effort-driven", field: "selection", formatter: Slick.Formatters.Checkmark, editor: Slick.Editors.Checkbox },
                { id: "linkedNode1", name: "연결노드1", field: "linkedNode1", width: 80, cssClass: "cell-title", editor: Slick.Editors.Text, validator: requiredFieldValidator },
                { id: "linkedNode2", name: "연결노드2", field: "linkedNode2", width: 80, cssClass: "cell-title", editor: Slick.Editors.Text, validator: requiredFieldValidator },
                { id: "selectLinkLine", name: "링크라인선택", width: 80, minWidth: 20, maxWidth: 80, cssClass: "cell-effort-driven", field: "editLink", formatter: imageFormatter },
            ];

            for (var i = 0; i < 1; i++) {
                var d = (linkData[i] = {});

                d["selection"] = 0;
                d["linkedNode1"] = "NodeA " + i;
                d["linkedNode2"] = "NodeB " + i;
                d["selectLinkLine"] = 1;
            }

            linkGrid = new Slick.Grid("#linkGrid", linkData, linkGridColumns, options);

            linkGrid.onClick.subscribe(function (e, args) {
                if (args.cell == 3) {
                    var item = args.grid.getDataItem(args.row);

                    linkedNode1 = item["linkedNode1"];
                    linkedNode2 = item["linkedNode2"];

                    if(selectedNode != linkedNode1) {
                        sketchup.updateLink(selectedNode,item["linkedNode1"]);
                    }                        
                    else {
                        sketchup.updateLink(selectedNode,item["linkedNode2"]);
                    }
                        
                }
            });
        }

        var selectedNode = "";

        function createCellGrid() {

            var newColumns = [
                { id: "selection", name: "Selection", width: 80, minWidth: 20, maxWidth: 80, cssClass: "cell-effort-driven", field: "selection", formatter: Slick.Formatters.Checkmark, editor: Slick.Editors.Checkbox },
                { id: "name", name: "NAme", field: "name", width: 120, cssClass: "cell-title", editor: Slick.Editors.Text, validator: requiredFieldValidator },
                { id: "group", name: "Group", field: "group", width: 100, editor: Slick.Editors.LongText },
                { id: "visible", name: "Visiblity", width: 80, minWidth: 20, maxWidth: 80, cssClass: "cell-effort-driven", field: "visible", formatter: Slick.Formatters.Visible, editor: Slick.Editors.Checkbox },
            ];

            // for (var i = 0; i < 500; i++) {
            //     var d = (data[i] = {});

            //     d["selection"] = i % 5 == 0;
            //     d["name"] = "Node " + i;
            //     d["poiType"] = "type 1";
            //     d["poiVisibile"] = i % 5 == 0;
            // }

            grid = new Slick.Grid("#myGrid", data, newColumns, options);

            grid.onClick.subscribe(function (e, args) {
                
            });
        }

        function createPoiGrid() {

            var newColumns = [
                { id: "selection", name: "선택", width: 40, minWidth: 20, maxWidth: 80, cssClass: "cell-effort-driven", field: "selection", formatter: Slick.Formatters.Checkmark, editor: Slick.Editors.Checkbox },
                { id: "name", name: "이름", field: "name", width: 80, cssClass: "cell-title", editor: Slick.Editors.Text, validator: requiredFieldValidator },
                { id: "poiType", name: "종류", field: "poiType", width: 200, editor: Slick.Editors.LongText },
                { id: "poiVisibile", name: "가시화", width: 60, minWidth: 20, maxWidth: 80, cssClass: "cell-effort-driven", field: "poiVisibile", formatter: Slick.Formatters.Visible, editor: Slick.Editors.Checkbox },
            ];

            // for (var i = 0; i < 500; i++) {
            //     var d = (data[i] = {});

            //     d["selection"] = i % 5 == 0;
            //     d["name"] = "Node " + i;
            //     d["poiType"] = "type 1";
            //     d["poiVisibile"] = i % 5 == 0;
            // }

            grid = new Slick.Grid("#myGrid", data, newColumns, options);

            grid.onClick.subscribe(function (e, args) {
                var item = args.cell + "," + args.row;
            });
        }

        function createFloorGrid() {

            var newColumns = [
                { id: "selection", name: "선택", width: 40, minWidth: 20, maxWidth: 80, cssClass: "cell-effort-driven", field: "selection", formatter: Slick.Formatters.Checkmark, editor: Slick.Editors.Checkbox },
                { id: "name", name: "층", field: "name", width: 80, cssClass: "cell-title", editor: Slick.Editors.Text, validator: requiredFieldValidator },
                { id: "floorElevation", name: "지면고도", field: "floorElevation", width: 100, editor: Slick.Editors.LongText },
                { id: "floorHeight", name: "높이", field: "floorHeight", width: 100, editor: Slick.Editors.LongText },
                { id: "floorVisibile", name: "가시화", width: 70, minWidth: 20, maxWidth: 80, cssClass: "cell-effort-driven", field: "floorVisibile", formatter: Slick.Formatters.Visible, editor: Slick.Editors.Checkbox },
            ];

            grid = new Slick.Grid("#myGrid", data, newColumns, options);

            grid.onClick.subscribe(function (e, args) {
                var item = args.cell + "," + args.row;
            });
        }

        function updateCell(cell) {
            //alert(cell);
            app.cell = cell;
            app.door = null;
            app.node = null;
            app.poi = null;
            app.floor = null;
            app.floors = null;
            editMode = "CELL";
            var x = document.getElementById("input_cell_name");

            if (x != undefined) {
                x.value = cell.name;
            }

            var y = document.getElementById("input_group_name");

            if (y != undefined) {
                y.value = cell.layer;
            }

            document.getElementById("selectCellType").value = cell.type;

            updateTitle("Cell Properties");
        }        

        linkHash = new Array();

        function updateLink(link_hash) {
            linkHash = link_hash;            
        }        

        function updateNode(node) {
            app.cell = null;
            app.door = null;
            app.node = node;
            app.poi = null;
            app.floor = null;
            app.floors = null;
            editMode = "NODE";
            updateTitle("Node Properties");

            if (null == node)
                return;

            var nodeName = document.getElementById("inputNodeName");

            if (null != nodeName) {
                nodeName.value = node.name;
            }

            var x = document.getElementById("node_xcoordinate");

            if (x != undefined) {
                x.value = node.x;
            }

            var y = document.getElementById("node_ycoordinate");

            if (y != undefined) {
                y.value = node.y;
            }
        }

        function updatePoi(poi) {
            app.cell = null;
            app.door = null;
            app.node = null;
            app.floor = null;
            app.floors = null;
            app.poi = poi;
            editMode = "POI";

            var x = document.getElementById("poi_xcoordinate");

            if (x != undefined) {
                x.value = poi.x;
            }

            var y = document.getElementById("poi_ycoordinate");

            if (y != undefined) {
                y.value = poi.y;
            }

            updateTitle("Poi Properties");
        }

        //아무것도 선택하지 않은 상태
        function updateNone() {
            app.cell = null;
            app.door = null;
            app.node = null;
            app.poi = null;
            app.floor = null;
            app.floors = null;
        }

        function onFloorChanged() {
            var x = document.getElementById("selectPoiType");

            app.floor = app.floors[x.value];

            var elevation = document.getElementById("textInputFloorElevation");

            elevation.value = app.floor.elevation;

            var floorHeight = document.getElementById("textInputFloorHeight");

            floorHeight.value = app.floor.height;

            var floorName = document.getElementById("textInputFloorName");

            floorName.value = app.floor.name;
        }

        function updateFloor(floors) {
            updateNone();
            app.floors = floors;

            if (floors.length > 0) {
                app.floor = floors[0];
            }

            editMode = "FLOOR";
            updateTitle("Floor Properties");

            var x = document.getElementById("dropdownFloor");

            // removeOptions(x);

            // for (var i = 0; i < floors.length; i++) {
            //     var option = document.createElement("option");
            //     option.text = floors[i].name;
            //     option.value = i.toString();
            //     x.add(option);
            // }

            document.getElementById("textInputFloorName").value = app.floor.name;
            document.getElementById("textInputFloorElevation").value = app.floor.elevation;
            document.getElementById("textInputFloorHeight").value = app.floor.height;

            updateFloorGrid(floors);
        }

        function onDropdownFloorChanged() {
            var x = document.getElementById("dropdownFloor");
        }

        function removeOptions(selectElement) {
            var i, L = selectElement.options.length - 1;
            for (i = L; i >= 0; i--) {
                selectElement.remove(i);
            }
        }

        $(document).ready(function () {

        });

        function hideLinkGrid() {
            document.getElementById("linkGridDiv").style.display = "none";
            document.getElementById("linkGridHeader").style.display = "none";
        }
    </script>
    <script>
        function requiredFieldValidator(value) {
            if (value == null || value == undefined || !value.length) {
                return { valid: false, msg: "This is a required field" };
            } else {
                return { valid: true, msg: null };
            }
        }

        var grid;
        var linkGrid;
        var data = [];
        var linkData = [];

        var columns = [
            { id: "selection", name: "Selection", width: 80, minWidth: 20, maxWidth: 80, cssClass: "cell-effort-driven", field: "selection", formatter: Slick.Formatters.Checkmark, editor: Slick.Editors.Checkbox },
            { id: "name", name: "NAme", field: "name", width: 120, cssClass: "cell-title", editor: Slick.Editors.Text, validator: requiredFieldValidator },
            { id: "group", name: "Group", field: "group", width: 100, editor: Slick.Editors.LongText },
            //{ id: "duration", name: "Duration", field: "duration", editor: Slick.Editors.Text },
            //{ id: "%", name: "% Complete", field: "percentComplete", width: 80, resizable: false, formatter: Slick.Formatters.PercentCompleteBar, editor: Slick.Editors.PercentComplete },
            //{ id: "start", name: "Start", field: "start", minWidth: 60, editor: Slick.Editors.Date },
            //{ id: "finish", name: "Finish", field: "finish", minWidth: 60, editor: Slick.Editors.Date },
            { id: "visible", name: "Visiblity", width: 80, minWidth: 20, maxWidth: 80, cssClass: "cell-effort-driven", field: "visible", formatter: Slick.Formatters.Visible, editor: Slick.Editors.Checkbox },
        ];

        var options = {
            editable: true,
            enableAddRow: false,
            enableCellNavigation: true,
            asyncEditorLoading: false,
            autoEdit: false,
            headerRowHeight: 1000,
            editCommandHandler: queueAndExecuteCommand,
        };

        var commandQueue = [];

        function queueAndExecuteCommand(item, column, editCommand) {
            commandQueue.push(editCommand);
            var oldName = item.name
            editCommand.execute();
            if (editMode == "CELL") {
                sketchup.updateCell(item, oldName);
            }
            else if (editMode == "NODE") {
                sketchup.updateNode(item, oldName);
            }            
        }

        function undo() {
            var command = commandQueue.pop();
            if (command && Slick.GlobalEditorLock.cancelCurrentEdit()) {
                command.undo();
                grid.gotoCell(command.row, command.cell, false);
            }
        }

        var imageFormatter = function () {
            return "<img class='clickableImage' src='../images/link.png' />";
        };

        // $(function () {
        //     for (var i = 0; i < 1; i++) {
        //         var d = (data[i] = {});

        //         d["selection"] = true;
        //         d["name"] = "cell " + i;
        //         d["group"] = "group";
        //         d["visible"] = true;
        //     }

        //     grid = new Slick.Grid("#myGrid", data, columns, options);
        // });
    </script>
</body>

</html>